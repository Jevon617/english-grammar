function wt(t,e){return new RegExp(`^${e}$`,"i").test(t.nodeName)}function le(){const t=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];let e="";for(let n=0;n<13;n++){const o=Math.round(Math.random()*(t.length-1));e+=t[o]}return e}function et(t){return/^(\s*)\n+(\s*)$/.test(t)}function yt(t){return typeof t=="string"&&(t=t.replace(/\u200B/g,"")),t}function ae(t,e){const n=o=>`---------- ${e} ${o?"start":"end"} ----------`;console.log(n(1)),console.log(t),console.log(n(0))}function fe(t,e){return e=e||"",e.replace(/\s/g,"").length===0?!1:new RegExp(" "+e+" ").test(" "+t.className+" ")}function xt(t,e){fe(t,e)||(t.className=t.className===""?e:t.className+" "+e)}function ue(t,e){const n=e.parentNode;n.lastChild===e?n.appendChild(t):n.insertBefore(t,e.nextSibling)}class de{constructor(e){const n=Object.assign({debug:!1},e);this.options=n}create(e,n){const o=n&&n.selection||window.getSelection();return this.tagName=e||"mark",this._create(o)}_create(e){let n=[];if(e.rangeCount>0){const o=e.getRangeAt(0),i=o.startContainer,s=o.endContainer;if(i&&s)if(i===s||i.parentNode===s.parentNode){const r=this._createMarkElement();o.surroundContents(r),n.push(r)}else{const r=this._surroundCrossContents(o);n=n.concat(r)}else i?s||console.error("range.endContainer does not exist"):console.error("range.startContainer does not exist");e.removeAllRanges()}return n}_getNewRange(e){const n=e.commonAncestorContainer,o=e.startContainer,i=e.endContainer,s=[];let r=!1,l=!1;function a(c){const g=c.childNodes;for(let u=0;u<g.length;u++){const d=g[u];if(l)break;d===o&&(r=!0),d===i&&(l=!0),d.nodeType===1?d.contains(o)||d.contains(i)?a(d):r&&s.push(d):d.nodeType===3&&!et(d.nodeValue)&&r&&s.push(d)}}return a(n),{nodeList:s,startOffset:e.startOffset,endOffset:e.endOffset}}_surroundCrossContents(e){const n=this.options,o=this._getNewRange(e),i=o.nodeList,s=o.startOffset,r=o.endOffset,l=i.length,a=[];return n.debug&&ae(o,"newRange"),i.forEach((c,g)=>{const u=c.parentNode,d=c.nodeValue,f=this._createMarkElement();if(g===0){if(c.nodeType===3){const m=c.nextSibling;f.innerText=d.substr(s),c.nodeValue=d.substr(0,s),m?u.insertBefore(f,m):u.appendChild(f),a.push(f)}}else if(g===l-1){if(c.nodeType===3){const m=c.previousSibling;f.innerText=d.substr(0,r),c.nodeValue=d.substr(r),m?ue(f,m):u.insertBefore(f,c),a.push(f)}}else c.nodeType===3?(f.innerText=d,u.replaceChild(f,c)):(f.innerHTML=c.innerHTML,c.innerHTML="",c.appendChild(f)),a.push(f)}),a}_createMarkElement(){const e=this.tagName;return document.createElement(e)}}class ge extends de{constructor(e,n){if(super(n),e===null)throw new Error("TextareaElem does not exist");const o={tagName:"mark",debug:!1};this.options=Object.assign(o,this.options),this.textareaElem=e,this.innerData={points:[]}}mark(e,n){if(e==="exchange")if(n&&n.points&&n.points.length>0)this.innerData.points=n.points.sort((o,i)=>o-i);else throw new Error("Required parameter options.points");return this._mark(e)}automark(e,n){if(e&&e.length>0){let o=0;const i=()=>{const s=e[o],r=this._getRangeData(s.startOffset,s.endOffset),l=window.getSelection(),a=window.document.createRange(),c=r.startRange,g=r.endRange;try{a.setStart(c.node,c.offset),a.setEnd(g.node,g.offset),l.addRange(a)}catch(d){console.error(d),console.error(`${JSON.stringify(s)}`)}const u=this._mark(s.type,s);n&&n.afterEach&&n.afterEach(u),++o<=e.length-1?i():n&&n.after&&n.after()};window.getSelection().removeAllRanges(),i()}}getContent(){const n=window.getSelection().getRangeAt(0);let o="";return n&&(o=n.toString()),o.replace(/\n/g,"").trim()}innerText(){let e="";const n=o=>{for(let i=0;i<o.length;i++){const s=o[i];s.nodeType===3&&!et(s.nodeValue)?e+=s.nodeValue:s.nodeType===1&&(n(s.childNodes),wt(s,"p")&&(e+=`
`))}};return n(this.textareaElem.childNodes),yt(e)}_mark(e,n){const o=window.getSelection();let i;if(o.rangeCount>0){const s=o.getRangeAt(0),r=s.startContainer===s.endContainer&&s.startOffset===s.endOffset,l=this.create(this.options.tagName,o);l.length>0&&(n?i=n:(i=this._getData(l[0],l[l.length-1]),i.content=r?"缺漏":i.content,i.points=e==="exchange"?this.innerData.points:[],i.key=le(),i.type=r?"missing":e),this._setElems(l,i))}return i}_setElems(e,n){if(e&&e.length>0){const o=n.type==="exchange"?this._drawExchange(n):null;e.forEach(i=>{i.setAttribute("markkey",n.key),i.setAttribute("marktype",n.type),xt(i,`mark-error mark-${n.type}`),o&&o(i)})}}_drawExchange(e){let n=0;const o=e&&e.points||this.innerData.points,i=e&&e.content.replace(/\n/g,"");return function s(r){const l=Array.prototype.slice.call(r.childNodes);for(let a=0;a<l.length;a++){const c=l[a];if(c.nodeType===3&&!et(c.nodeValue)){const g=c.nodeValue,u=document.createDocumentFragment();for(let d=0;d<g.length;d++){let f="";const m=document.createElement("i");m.innerHTML=g.charAt(d),n===0?f="left":n===i.length-1&&(f="right"),xt(m,f),n===o[0]?f="focus focus1":o[1]&&n===o[1]+1?f="focus focus2":n<o[0]||o[1]&&n>o[1]+1?f="top":f="bottom",xt(m,f),m.setAttribute("marktype",e.type),u.appendChild(m),n++}c.parentNode.replaceChild(u,c)}else c.nodeType===1&&s(c)}}}_getData(e,n){let o=0,i="",s=null,r=null,l=null;const a=c=>{for(let g=0;g<c.length;g++){const u=c[g];if(r!==null)break;if(u.nodeType===3&&!et(u.nodeValue)){const d=yt(u.nodeValue);o+=d.length,i+=s!==null?d:""}else if(u.nodeType===1){if(u===e&&(s=o),u===n){const d=u.innerText;r=o+d.length,l=r-s,i+=d}a(u.childNodes),!r&&wt(u,"p")&&(o++,i+=`
`)}}};return a(this.textareaElem.childNodes),{content:i.trim(),startOffset:s,endOffset:r,length:l}}_getRangeData(e,n){let o=0,i=null,s=null;const r=l=>{for(let a=0;a<l.length;a++){const c=l[a];if(s!==null)break;if(c.nodeType===3&&!et(c.nodeValue)){const g=o,u=yt(c.nodeValue);if(o+=u.length,!i&&o>=e){const d=e-g;i={node:c,offset:d<0?0:d}}if(!s&&o>=n){const d=n-g;s={node:c,offset:d<0?0:d}}}else c.nodeType===1&&(r(c.childNodes),!s&&wt(c,"p")&&o++)}};return r(this.textareaElem.childNodes),{startRange:i,endRange:s}}}let ct=null;function me(t){ct=t}function he(){if(ct){const t=window.getSelection();t.removeAllRanges(),t.addRange(ct),ct=null}}const Wt="__astro__english__grammar__";function jt(){let t=localStorage.getItem(Wt);try{return t=JSON.parse(t)||{},t}catch{return{}}}function pe(){const t=zt();return jt()[t]||[]}function we(t){const e=zt(),n=jt();n[e]=t||[],localStorage.setItem(Wt,JSON.stringify(n))}function zt(){const t=window.location.href;return btoa(t)}const Y=Math.min,q=Math.max,at=Math.round,rt=Math.floor,C=t=>({x:t,y:t}),ye={left:"right",right:"left",bottom:"top",top:"bottom"},xe={start:"end",end:"start"};function vt(t,e,n){return q(t,Y(e,n))}function ot(t,e){return typeof t=="function"?t(e):t}function H(t){return t.split("-")[0]}function it(t){return t.split("-")[1]}function Yt(t){return t==="x"?"y":"x"}function At(t){return t==="y"?"height":"width"}function X(t){return["top","bottom"].includes(H(t))?"y":"x"}function Rt(t){return Yt(X(t))}function be(t,e,n){n===void 0&&(n=!1);const o=it(t),i=Rt(t),s=At(i);let r=i==="x"?o===(n?"end":"start")?"right":"left":o==="start"?"bottom":"top";return e.reference[s]>e.floating[s]&&(r=ft(r)),[r,ft(r)]}function ve(t){const e=ft(t);return[Et(t),e,Et(e)]}function Et(t){return t.replace(/start|end/g,e=>xe[e])}function Ee(t,e,n){const o=["left","right"],i=["right","left"],s=["top","bottom"],r=["bottom","top"];switch(t){case"top":case"bottom":return n?e?i:o:e?o:i;case"left":case"right":return e?s:r;default:return[]}}function Se(t,e,n,o){const i=it(t);let s=Ee(H(t),n==="start",o);return i&&(s=s.map(r=>r+"-"+i),e&&(s=s.concat(s.map(Et)))),s}function ft(t){return t.replace(/left|right|bottom|top/g,e=>ye[e])}function Te(t){return{top:0,right:0,bottom:0,left:0,...t}}function Xt(t){return typeof t!="number"?Te(t):{top:t,right:t,bottom:t,left:t}}function ut(t){const{x:e,y:n,width:o,height:i}=t;return{width:o,height:i,top:n,left:e,right:e+o,bottom:n+i,x:e,y:n}}function _t(t,e,n){let{reference:o,floating:i}=t;const s=X(e),r=Rt(e),l=At(r),a=H(e),c=s==="y",g=o.x+o.width/2-i.width/2,u=o.y+o.height/2-i.height/2,d=o[l]/2-i[l]/2;let f;switch(a){case"top":f={x:g,y:o.y-i.height};break;case"bottom":f={x:g,y:o.y+o.height};break;case"right":f={x:o.x+o.width,y:u};break;case"left":f={x:o.x-i.width,y:u};break;default:f={x:o.x,y:o.y}}switch(it(e)){case"start":f[r]-=d*(n&&c?-1:1);break;case"end":f[r]+=d*(n&&c?-1:1);break}return f}const Ae=async(t,e,n)=>{const{placement:o="bottom",strategy:i="absolute",middleware:s=[],platform:r}=n,l=s.filter(Boolean),a=await(r.isRTL==null?void 0:r.isRTL(e));let c=await r.getElementRects({reference:t,floating:e,strategy:i}),{x:g,y:u}=_t(c,o,a),d=o,f={},m=0;for(let h=0;h<l.length;h++){const{name:w,fn:p}=l[h],{x:y,y:x,data:v,reset:b}=await p({x:g,y:u,initialPlacement:o,placement:d,strategy:i,middlewareData:f,rects:c,platform:r,elements:{reference:t,floating:e}});g=y??g,u=x??u,f={...f,[w]:{...f[w],...v}},b&&m<=50&&(m++,typeof b=="object"&&(b.placement&&(d=b.placement),b.rects&&(c=b.rects===!0?await r.getElementRects({reference:t,floating:e,strategy:i}):b.rects),{x:g,y:u}=_t(c,d,a)),h=-1)}return{x:g,y:u,placement:d,strategy:i,middlewareData:f}};async function Jt(t,e){var n;e===void 0&&(e={});const{x:o,y:i,platform:s,rects:r,elements:l,strategy:a}=t,{boundary:c="clippingAncestors",rootBoundary:g="viewport",elementContext:u="floating",altBoundary:d=!1,padding:f=0}=ot(e,t),m=Xt(f),w=l[d?u==="floating"?"reference":"floating":u],p=ut(await s.getClippingRect({element:(n=await(s.isElement==null?void 0:s.isElement(w)))==null||n?w:w.contextElement||await(s.getDocumentElement==null?void 0:s.getDocumentElement(l.floating)),boundary:c,rootBoundary:g,strategy:a})),y=u==="floating"?{x:o,y:i,width:r.floating.width,height:r.floating.height}:r.reference,x=await(s.getOffsetParent==null?void 0:s.getOffsetParent(l.floating)),v=await(s.isElement==null?void 0:s.isElement(x))?await(s.getScale==null?void 0:s.getScale(x))||{x:1,y:1}:{x:1,y:1},b=ut(s.convertOffsetParentRelativeRectToViewportRelativeRect?await s.convertOffsetParentRelativeRectToViewportRelativeRect({elements:l,rect:y,offsetParent:x,strategy:a}):y);return{top:(p.top-b.top+m.top)/v.y,bottom:(b.bottom-p.bottom+m.bottom)/v.y,left:(p.left-b.left+m.left)/v.x,right:(b.right-p.right+m.right)/v.x}}const Re=t=>({name:"arrow",options:t,async fn(e){const{x:n,y:o,placement:i,rects:s,platform:r,elements:l,middlewareData:a}=e,{element:c,padding:g=0}=ot(t,e)||{};if(c==null)return{};const u=Xt(g),d={x:n,y:o},f=Rt(i),m=At(f),h=await r.getDimensions(c),w=f==="y",p=w?"top":"left",y=w?"bottom":"right",x=w?"clientHeight":"clientWidth",v=s.reference[m]+s.reference[f]-d[f]-s.floating[m],b=d[f]-s.reference[f],R=await(r.getOffsetParent==null?void 0:r.getOffsetParent(c));let V=R?R[x]:0;(!V||!await(r.isElement==null?void 0:r.isElement(R)))&&(V=l.floating[x]||s.floating[m]);const G=v/2-b/2,F=V/2-h[m]/2-1,P=Y(u[p],F),Q=Y(u[y],F),B=P,tt=V-h[m]-Q,E=V/2-h[m]/2+G,W=vt(B,E,tt),N=!a.arrow&&it(i)!=null&&E!==W&&s.reference[m]/2-(E<B?P:Q)-h[m]/2<0,k=N?E<B?E-B:E-tt:0;return{[f]:d[f]+k,data:{[f]:W,centerOffset:E-W-k,...N&&{alignmentOffset:k}},reset:N}}}),ke=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var n,o;const{placement:i,middlewareData:s,rects:r,initialPlacement:l,platform:a,elements:c}=e,{mainAxis:g=!0,crossAxis:u=!0,fallbackPlacements:d,fallbackStrategy:f="bestFit",fallbackAxisSideDirection:m="none",flipAlignment:h=!0,...w}=ot(t,e);if((n=s.arrow)!=null&&n.alignmentOffset)return{};const p=H(i),y=X(l),x=H(l)===l,v=await(a.isRTL==null?void 0:a.isRTL(c.floating)),b=d||(x||!h?[ft(l)]:ve(l)),R=m!=="none";!d&&R&&b.push(...Se(l,h,m,v));const V=[l,...b],G=await Jt(e,w),F=[];let P=((o=s.flip)==null?void 0:o.overflows)||[];if(g&&F.push(G[p]),u){const E=be(i,r,v);F.push(G[E[0]],G[E[1]])}if(P=[...P,{placement:i,overflows:F}],!F.every(E=>E<=0)){var Q,B;const E=(((Q=s.flip)==null?void 0:Q.index)||0)+1,W=V[E];if(W)return{data:{index:E,overflows:P},reset:{placement:W}};let N=(B=P.filter(k=>k.overflows[0]<=0).sort((k,M)=>k.overflows[1]-M.overflows[1])[0])==null?void 0:B.placement;if(!N)switch(f){case"bestFit":{var tt;const k=(tt=P.filter(M=>{if(R){const _=X(M.placement);return _===y||_==="y"}return!0}).map(M=>[M.placement,M.overflows.filter(_=>_>0).reduce((_,ce)=>_+ce,0)]).sort((M,_)=>M[1]-_[1])[0])==null?void 0:tt[0];k&&(N=k);break}case"initialPlacement":N=l;break}if(i!==N)return{reset:{placement:N}}}return{}}}};async function Ce(t,e){const{placement:n,platform:o,elements:i}=t,s=await(o.isRTL==null?void 0:o.isRTL(i.floating)),r=H(n),l=it(n),a=X(n)==="y",c=["left","top"].includes(r)?-1:1,g=s&&a?-1:1,u=ot(e,t);let{mainAxis:d,crossAxis:f,alignmentAxis:m}=typeof u=="number"?{mainAxis:u,crossAxis:0,alignmentAxis:null}:{mainAxis:u.mainAxis||0,crossAxis:u.crossAxis||0,alignmentAxis:u.alignmentAxis};return l&&typeof m=="number"&&(f=l==="end"?m*-1:m),a?{x:f*g,y:d*c}:{x:d*c,y:f*g}}const Oe=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var n,o;const{x:i,y:s,placement:r,middlewareData:l}=e,a=await Ce(e,t);return r===((n=l.offset)==null?void 0:n.placement)&&(o=l.arrow)!=null&&o.alignmentOffset?{}:{x:i+a.x,y:s+a.y,data:{...a,placement:r}}}}},Le=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:n,y:o,placement:i}=e,{mainAxis:s=!0,crossAxis:r=!1,limiter:l={fn:w=>{let{x:p,y}=w;return{x:p,y}}},...a}=ot(t,e),c={x:n,y:o},g=await Jt(e,a),u=X(H(i)),d=Yt(u);let f=c[d],m=c[u];if(s){const w=d==="y"?"top":"left",p=d==="y"?"bottom":"right",y=f+g[w],x=f-g[p];f=vt(y,f,x)}if(r){const w=u==="y"?"top":"left",p=u==="y"?"bottom":"right",y=m+g[w],x=m-g[p];m=vt(y,m,x)}const h=l.fn({...e,[d]:f,[u]:m});return{...h,data:{x:h.x-n,y:h.y-o,enabled:{[d]:s,[u]:r}}}}}};function mt(){return typeof window<"u"}function Z(t){return Ut(t)?(t.nodeName||"").toLowerCase():"#document"}function S(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function L(t){var e;return(e=(Ut(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function Ut(t){return mt()?t instanceof Node||t instanceof S(t).Node:!1}function T(t){return mt()?t instanceof Element||t instanceof S(t).Element:!1}function O(t){return mt()?t instanceof HTMLElement||t instanceof S(t).HTMLElement:!1}function $t(t){return!mt()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof S(t).ShadowRoot}function st(t){const{overflow:e,overflowX:n,overflowY:o,display:i}=A(t);return/auto|scroll|overlay|hidden|clip/.test(e+o+n)&&!["inline","contents"].includes(i)}function Ne(t){return["table","td","th"].includes(Z(t))}function ht(t){return[":popover-open",":modal"].some(e=>{try{return t.matches(e)}catch{return!1}})}function kt(t){const e=Ct(),n=T(t)?A(t):t;return n.transform!=="none"||n.perspective!=="none"||(n.containerType?n.containerType!=="normal":!1)||!e&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!e&&(n.filter?n.filter!=="none":!1)||["transform","perspective","filter"].some(o=>(n.willChange||"").includes(o))||["paint","layout","strict","content"].some(o=>(n.contain||"").includes(o))}function De(t){let e=$(t);for(;O(e)&&!J(e);){if(kt(e))return e;if(ht(e))return null;e=$(e)}return null}function Ct(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function J(t){return["html","body","#document"].includes(Z(t))}function A(t){return S(t).getComputedStyle(t)}function pt(t){return T(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function $(t){if(Z(t)==="html")return t;const e=t.assignedSlot||t.parentNode||$t(t)&&t.host||L(t);return $t(e)?e.host:e}function Kt(t){const e=$(t);return J(e)?t.ownerDocument?t.ownerDocument.body:t.body:O(e)&&st(e)?e:Kt(e)}function nt(t,e,n){var o;e===void 0&&(e=[]),n===void 0&&(n=!0);const i=Kt(t),s=i===((o=t.ownerDocument)==null?void 0:o.body),r=S(i);if(s){const l=St(r);return e.concat(r,r.visualViewport||[],st(i)?i:[],l&&n?nt(l):[])}return e.concat(i,nt(i,[],n))}function St(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function Zt(t){const e=A(t);let n=parseFloat(e.width)||0,o=parseFloat(e.height)||0;const i=O(t),s=i?t.offsetWidth:n,r=i?t.offsetHeight:o,l=at(n)!==s||at(o)!==r;return l&&(n=s,o=r),{width:n,height:o,$:l}}function Ot(t){return T(t)?t:t.contextElement}function j(t){const e=Ot(t);if(!O(e))return C(1);const n=e.getBoundingClientRect(),{width:o,height:i,$:s}=Zt(e);let r=(s?at(n.width):n.width)/o,l=(s?at(n.height):n.height)/i;return(!r||!Number.isFinite(r))&&(r=1),(!l||!Number.isFinite(l))&&(l=1),{x:r,y:l}}const Pe=C(0);function Gt(t){const e=S(t);return!Ct()||!e.visualViewport?Pe:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function Me(t,e,n){return e===void 0&&(e=!1),!n||e&&n!==S(t)?!1:e}function I(t,e,n,o){e===void 0&&(e=!1),n===void 0&&(n=!1);const i=t.getBoundingClientRect(),s=Ot(t);let r=C(1);e&&(o?T(o)&&(r=j(o)):r=j(t));const l=Me(s,n,o)?Gt(s):C(0);let a=(i.left+l.x)/r.x,c=(i.top+l.y)/r.y,g=i.width/r.x,u=i.height/r.y;if(s){const d=S(s),f=o&&T(o)?S(o):o;let m=d,h=St(m);for(;h&&o&&f!==m;){const w=j(h),p=h.getBoundingClientRect(),y=A(h),x=p.left+(h.clientLeft+parseFloat(y.paddingLeft))*w.x,v=p.top+(h.clientTop+parseFloat(y.paddingTop))*w.y;a*=w.x,c*=w.y,g*=w.x,u*=w.y,a+=x,c+=v,m=S(h),h=St(m)}}return ut({width:g,height:u,x:a,y:c})}function Lt(t,e){const n=pt(t).scrollLeft;return e?e.left+n:I(L(t)).left+n}function Qt(t,e,n){n===void 0&&(n=!1);const o=t.getBoundingClientRect(),i=o.left+e.scrollLeft-(n?0:Lt(t,o)),s=o.top+e.scrollTop;return{x:i,y:s}}function _e(t){let{elements:e,rect:n,offsetParent:o,strategy:i}=t;const s=i==="fixed",r=L(o),l=e?ht(e.floating):!1;if(o===r||l&&s)return n;let a={scrollLeft:0,scrollTop:0},c=C(1);const g=C(0),u=O(o);if((u||!u&&!s)&&((Z(o)!=="body"||st(r))&&(a=pt(o)),O(o))){const f=I(o);c=j(o),g.x=f.x+o.clientLeft,g.y=f.y+o.clientTop}const d=r&&!u&&!s?Qt(r,a,!0):C(0);return{width:n.width*c.x,height:n.height*c.y,x:n.x*c.x-a.scrollLeft*c.x+g.x+d.x,y:n.y*c.y-a.scrollTop*c.y+g.y+d.y}}function $e(t){return Array.from(t.getClientRects())}function Ve(t){const e=L(t),n=pt(t),o=t.ownerDocument.body,i=q(e.scrollWidth,e.clientWidth,o.scrollWidth,o.clientWidth),s=q(e.scrollHeight,e.clientHeight,o.scrollHeight,o.clientHeight);let r=-n.scrollLeft+Lt(t);const l=-n.scrollTop;return A(o).direction==="rtl"&&(r+=q(e.clientWidth,o.clientWidth)-i),{width:i,height:s,x:r,y:l}}function Fe(t,e){const n=S(t),o=L(t),i=n.visualViewport;let s=o.clientWidth,r=o.clientHeight,l=0,a=0;if(i){s=i.width,r=i.height;const c=Ct();(!c||c&&e==="fixed")&&(l=i.offsetLeft,a=i.offsetTop)}return{width:s,height:r,x:l,y:a}}function Be(t,e){const n=I(t,!0,e==="fixed"),o=n.top+t.clientTop,i=n.left+t.clientLeft,s=O(t)?j(t):C(1),r=t.clientWidth*s.x,l=t.clientHeight*s.y,a=i*s.x,c=o*s.y;return{width:r,height:l,x:a,y:c}}function Vt(t,e,n){let o;if(e==="viewport")o=Fe(t,n);else if(e==="document")o=Ve(L(t));else if(T(e))o=Be(e,n);else{const i=Gt(t);o={x:e.x-i.x,y:e.y-i.y,width:e.width,height:e.height}}return ut(o)}function te(t,e){const n=$(t);return n===e||!T(n)||J(n)?!1:A(n).position==="fixed"||te(n,e)}function qe(t,e){const n=e.get(t);if(n)return n;let o=nt(t,[],!1).filter(l=>T(l)&&Z(l)!=="body"),i=null;const s=A(t).position==="fixed";let r=s?$(t):t;for(;T(r)&&!J(r);){const l=A(r),a=kt(r);!a&&l.position==="fixed"&&(i=null),(s?!a&&!i:!a&&l.position==="static"&&!!i&&["absolute","fixed"].includes(i.position)||st(r)&&!a&&te(t,r))?o=o.filter(g=>g!==r):i=l,r=$(r)}return e.set(t,o),o}function He(t){let{element:e,boundary:n,rootBoundary:o,strategy:i}=t;const r=[...n==="clippingAncestors"?ht(e)?[]:qe(e,this._c):[].concat(n),o],l=r[0],a=r.reduce((c,g)=>{const u=Vt(e,g,i);return c.top=q(u.top,c.top),c.right=Y(u.right,c.right),c.bottom=Y(u.bottom,c.bottom),c.left=q(u.left,c.left),c},Vt(e,l,i));return{width:a.right-a.left,height:a.bottom-a.top,x:a.left,y:a.top}}function Ie(t){const{width:e,height:n}=Zt(t);return{width:e,height:n}}function We(t,e,n){const o=O(e),i=L(e),s=n==="fixed",r=I(t,!0,s,e);let l={scrollLeft:0,scrollTop:0};const a=C(0);if(o||!o&&!s)if((Z(e)!=="body"||st(i))&&(l=pt(e)),o){const d=I(e,!0,s,e);a.x=d.x+e.clientLeft,a.y=d.y+e.clientTop}else i&&(a.x=Lt(i));const c=i&&!o&&!s?Qt(i,l):C(0),g=r.left+l.scrollLeft-a.x-c.x,u=r.top+l.scrollTop-a.y-c.y;return{x:g,y:u,width:r.width,height:r.height}}function bt(t){return A(t).position==="static"}function Ft(t,e){if(!O(t)||A(t).position==="fixed")return null;if(e)return e(t);let n=t.offsetParent;return L(t)===n&&(n=n.ownerDocument.body),n}function ee(t,e){const n=S(t);if(ht(t))return n;if(!O(t)){let i=$(t);for(;i&&!J(i);){if(T(i)&&!bt(i))return i;i=$(i)}return n}let o=Ft(t,e);for(;o&&Ne(o)&&bt(o);)o=Ft(o,e);return o&&J(o)&&bt(o)&&!kt(o)?n:o||De(t)||n}const je=async function(t){const e=this.getOffsetParent||ee,n=this.getDimensions,o=await n(t.floating);return{reference:We(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:o.width,height:o.height}}};function ze(t){return A(t).direction==="rtl"}const Ye={convertOffsetParentRelativeRectToViewportRelativeRect:_e,getDocumentElement:L,getClippingRect:He,getOffsetParent:ee,getElementRects:je,getClientRects:$e,getDimensions:Ie,getScale:j,isElement:T,isRTL:ze};function Xe(t,e){let n=null,o;const i=L(t);function s(){var l;clearTimeout(o),(l=n)==null||l.disconnect(),n=null}function r(l,a){l===void 0&&(l=!1),a===void 0&&(a=1),s();const{left:c,top:g,width:u,height:d}=t.getBoundingClientRect();if(l||e(),!u||!d)return;const f=rt(g),m=rt(i.clientWidth-(c+u)),h=rt(i.clientHeight-(g+d)),w=rt(c),y={rootMargin:-f+"px "+-m+"px "+-h+"px "+-w+"px",threshold:q(0,Y(1,a))||1};let x=!0;function v(b){const R=b[0].intersectionRatio;if(R!==a){if(!x)return r();R?r(!1,R):o=setTimeout(()=>{r(!1,1e-7)},1e3)}x=!1}try{n=new IntersectionObserver(v,{...y,root:i.ownerDocument})}catch{n=new IntersectionObserver(v,y)}n.observe(t)}return r(!0),s}function Je(t,e,n,o){o===void 0&&(o={});const{ancestorScroll:i=!0,ancestorResize:s=!0,elementResize:r=typeof ResizeObserver=="function",layoutShift:l=typeof IntersectionObserver=="function",animationFrame:a=!1}=o,c=Ot(t),g=i||s?[...c?nt(c):[],...nt(e)]:[];g.forEach(p=>{i&&p.addEventListener("scroll",n,{passive:!0}),s&&p.addEventListener("resize",n)});const u=c&&l?Xe(c,n):null;let d=-1,f=null;r&&(f=new ResizeObserver(p=>{let[y]=p;y&&y.target===c&&f&&(f.unobserve(e),cancelAnimationFrame(d),d=requestAnimationFrame(()=>{var x;(x=f)==null||x.observe(e)})),n()}),c&&!a&&f.observe(c),f.observe(e));let m,h=a?I(t):null;a&&w();function w(){const p=I(t);h&&(p.x!==h.x||p.y!==h.y||p.width!==h.width||p.height!==h.height)&&n(),h=p,m=requestAnimationFrame(w)}return n(),()=>{var p;g.forEach(y=>{i&&y.removeEventListener("scroll",n),s&&y.removeEventListener("resize",n)}),u?.(),(p=f)==null||p.disconnect(),f=null,a&&cancelAnimationFrame(m)}}const Ue=Oe,Ke=Le,Ze=ke,Ge=Re,Qe=(t,e,n)=>{const o=new Map,i={platform:Ye,...n},s={...i.platform,_c:o};return Ae(t,e,{...i,platform:s})};function tn(){const t=navigator.userAgent;return/android/i.test(t)||/iPad|iPhone|iPod/.test(t)?"mobile":"Desktop"}const U=document.querySelector("#tooltip"),Bt=document.querySelector("#arrow"),Nt=document.querySelector("#anchor"),D=document.querySelector("main"),ne=document.querySelector("#note"),Dt=document.querySelector(".modal"),en=document.querySelector(".comment"),z=document.querySelector(".comment-input"),nn=document.querySelector(".reference-text"),oe=tn()==="Desktop";console.log(oe);const Pt=document.querySelector(".note-modal"),lt=document.querySelector(".note-modal .list"),on=document.querySelector(".note-modal .close");Dt.addEventListener("click",ie);on.addEventListener("click",re);en.addEventListener("click",t=>{t.stopPropagation()});z.addEventListener("blur",()=>{window.scroll(0,0),z.value&&ln(z.value),ie()});function ie(){z.value="",Dt.style.display="none"}function sn(){Dt.style.display="block"}const rn="mark-el",dt=pe(),se=new ge(document.querySelector("main"),{tagName:"mark-el"});let Tt;se.automark(dt);["touchstart","mousedown"].forEach(t=>{ne.addEventListener(t,cn),D.addEventListener(t,Mt)});["touchend","mouseup"].forEach(t=>{ne.addEventListener(t,e=>{e.stopPropagation()}),D.addEventListener(t,an)});D.addEventListener("click",t=>{const e=t.target.closest(rn);e&&gn(e.getAttribute("markkey"))});function cn(t){t.stopPropagation();const e=window.getSelection().toString();sn(),nn.innerHTML=e,Mt(0),oe?setTimeout(()=>{z.focus()}):z.focus()}function ln(t){he();const e=se.mark("modify");e&&(e.note=t,dt.push(e)),we(dt),Mt(0)}function an(){const t=window.getSelection();if(t.rangeCount>0&&t.toString().length!==0){const e=t.getRangeAt(0),n=e.getBoundingClientRect();Nt.style.cssText=`
      left: ${n.left-D.offsetLeft}px;
      top: ${n.top+D.scrollTop}px;
      width: ${n.width}px;
      height: ${n.height}px;
      position: absolute;
    `,me(e),un()}}function fn(){Qe(Nt,U,{placement:"bottom",middleware:[Ue(16),Ze(),Ke({padding:5}),Ge({element:Bt})]}).then(({x:t,y:e,placement:n,middlewareData:o})=>{Object.assign(U.style,{left:`${t}px`,top:`${e}px`});const{x:i,y:s}=o.arrow,r={top:"bottom",right:"left",bottom:"top",left:"right"}[n.split("-")[0]];Object.assign(Bt.style,{left:i!=null?`${i}px`:"",top:s!=null?`${s}px`:"",right:"",bottom:"",[r]:"-4px"})})}function un(){U.style.display="block",Tt=Je(Nt,U,fn)}function Mt(t=0){setTimeout(()=>{U.style.display==="block"&&(U.style.display="",Tt&&Tt())},t)}function dn(t){lt.innerHTML="";const e=dt.map(o=>{const i=document.createElement("div");return i.className="list-item",i.setAttribute("key",o.key),i.innerHTML=`
        <div class="header">
          <div class="name">Zoey</div>
          <div class="all-note">上下文</div>
        </div>
        <div class="original">
          <span>原文:</span>
          <span class="original-content">${o.content}</span>
        </div>
        <div class="note-content">${o.note}</div>
      `,i});lt.append(...e);const n=lt.querySelector(`div[key="${t}"]`);Pt.scrollTop=n?n.offsetTop:0}lt.addEventListener("click",t=>{const n=t.target.closest(".list-item");if(t.target.closest(".all-note")&&n){const o=n.getAttribute("key");re();const i=D.querySelector(`mark-el[markkey="${o}"]`);i&&(D.scrollTop=i.offsetTop)}});function gn(t){D.style.overflowY="hidden",Pt.style.display="block",dn(t)}function re(){D.style.overflowY="scroll",Pt.style.display="none"}const K=document.querySelector(".sidebar"),qt=localStorage.getItem("sidebar-scroll");K&&qt&&(K.scrollTop=parseInt(qt,10));window.addEventListener("beforeunload",()=>{K&&localStorage.setItem("sidebar-scroll",K.scrollTop+"")});const Ht=document.querySelector(".toggle");Ht&&K&&Ht.addEventListener("click",()=>{K.classList.toggle("max-md:toggle-hidden")});const It=document.querySelectorAll("h2");if(It.length){let t=function(e){const n=e.target;n&&(window.location.hash="#"+n.id)};It.forEach(e=>{e.addEventListener("click",t)})}const gt=document.querySelector("main"),mn=localStorage.getItem("pathname");if(mn===window.location.pathname){const t=localStorage.getItem("pageScroll");gt&&t&&(gt.scrollTop=parseInt(t,10))}window.addEventListener("beforeunload",()=>{localStorage.setItem("pathname",window.location.pathname),gt&&localStorage.setItem("pageScroll",gt.scrollTop+"")});document.addEventListener("keydown",t=>{switch(t.code){case"ArrowLeft":document.querySelector("#preChapter")?.click();break;case"ArrowRight":document.querySelector("#nextChapter")?.click();break}});
